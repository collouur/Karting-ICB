<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>ICB Karting Challenge</title>
<style>
  :root {
    --bg: #0b0e13;
    --card: #131823;
    --card-2: #0f141d;
    --text: #e8ecf1;
    --muted: #a6b0c0;
    --accent: #E99945;
    --line: #222a36;
    --hover: #0c111a;
    --success: #26a269;
    --danger: #f25056;
  }
  * { box-sizing: border-box; }
  html, body { margin: 0; padding: 0; background: radial-gradient(1200px 600px at 20% -10%, rgba(233,153,69,.16), transparent 70%), var(--bg); color: var(--text); font: 16px/1.45 Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
  .wrap { max-width: 1024px; margin: 32px auto 80px; padding: 0 16px; }
  .title { display: flex; align-items: center; gap: 16px; }
  .title h1 { font-size: 48px; margin: 0; letter-spacing: .5px; text-shadow: 0 2px 24px rgba(233,153,69,.2); }
  .title small { margin-top: 8px; display: block; color: var(--muted); }
  .badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 10px; background: rgba(233,153,69,.1); border: 1px solid rgba(233,153,69,.24); color: var(--text); font-weight: 600; }
  .badge img { width: 28px; height: 28px; }
  .card { background: linear-gradient(180deg, var(--card), var(--card-2)); border: 1px solid var(--line); border-radius: 16px; box-shadow: 0 12px 48px rgba(0,0,0,.35); overflow: hidden; }
  .toolbar { display: flex; gap: 12px; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--line); padding: 14px 16px; background: rgba(12,17,26,.35); }
  .search { position: relative; flex: 1; }
  .search input { width: 100%; background: var(--hover); border: 1px solid var(--line); color: var(--text); border-radius: 12px; outline: none; padding: 12px 16px; font-size: 15px; }
  .sorts { display: flex; gap: 8px; }
  .sort-btn { background: var(--hover); border: 1px solid var(--line); color: var(--text); padding: 10px 12px; border-radius: 999px; cursor: pointer; font-weight: 600; }
  .sort-btn.active { background: rgba(233,153,69,.12); border-color: rgba(233,153,69,.45); }
  table { width: 100%; border-collapse: collapse; }
  thead th { text-align: left; color: var(--muted); font-weight: 600; padding: 14px 16px; border-bottom: 1px solid var(--line); }
  tbody td { padding: 14px 16px; border-bottom: 1px solid var(--line); }
  tbody tr:hover { background: rgba(12,17,26,.35); }
  .right { text-align: right; }
  .muted { color: var(--muted); }
  .delta { display: inline-flex; align-items: center; gap: 6px; }
  .delta .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: var(--line); }
  .delta .up { background: var(--success); }
  .delta .down { background: var(--danger); }
  .foot { display: flex; align-items: center; justify-content: space-between; color: var(--muted); font-size: 13px; padding: 12px 16px; }
  .check { filter: drop-shadow(0 3px 18px rgba(255,255,255,.4)); }
  .note { color: var(--muted); font-size: 13px; margin-top: 8px; }
  .rank { width: 52px; }
  .name { min-width: 220px; }
  .num { width: 92px; text-align: right; }
</style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <span class="badge">
      <img alt="" src="data:image/svg+xml,%3Csvg width='32' height='32' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 16h10l3-6h-6l-1.5 3h-2L9 10H3l4 6Z' fill='%23E99945'/%3E%3C/svg%3E"/>
      ICB Karting Challenge
    </span>
    <h1>ICB Karting Challenge üèÅ</h1>
  </div>
  <small class="note">Refactor –Ω–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è—Ç–∞ ‚Üí –ø–æ-–±—ä—Ä–∑–∞ –æ–±–∏–∫–æ–ª–∫–∞.</small>

  <div class="card">
    <div class="toolbar">
      <div class="search">
        <input id="q" placeholder="Search driver..." type="search"/>
      </div>
      <div class="sorts">
        <button class="sort-btn" data-sort="best">Sort by Best</button>
        <button class="sort-btn" data-sort="first">Sort by First</button>
        <button class="sort-btn" data-sort="az">Sort A‚ÄìZ</button>
        <button class="sort-btn" data-sort="delta">Sort by Improvement</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th class="rank">‚Ññ</th>
          <th class="name">Name</th>
          <th>First Session Lap</th>
          <th>Best Lap Ever</th>
          <th class="right">Improvement</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <div class="foot">
      <span class="muted">üèÅ highlights close battles (‚â§ 1.0s).</span>
      <span id="count" class="muted">‚Äî</span>
    </div>
  </div>
</div>

<!-- Fallback data (unchanged v1.3) -->
<script id="data" type="application/json">[
  {"name":"Aleksandar Zhelyazkov","first_time":"1:09.036","best_time":"1:09.036"},
  {"name":"Nikola Stanoichev","first_time":"1:12.617","best_time":"1:12.617"},
  {"name":"Yordan Parladiyski","first_time":"1:12.968","best_time":"1:12.968"},
  {"name":"Georgi Mihalev","first_time":"1:15.215","best_time":"1:15.215"},
  {"name":"Dragomir Yanev","first_time":"1:15.319","best_time":"1:15.319"},
  {"name":"Dimitar Slavchev","first_time":"‚Äî","best_time":"‚Äî"},
  {"name":"Martin Atanasov","first_time":"‚Äî","best_time":"‚Äî"},
  {"name":"Kostadin Kostadinov","first_time":"‚Äî","best_time":"‚Äî"},
  {"name":"Sergey Prudnikov","first_time":"‚Äî","best_time":"‚Äî"},
  {"name":"Yavor Vasilev","first_time":"‚Äî","best_time":"‚Äî"},
  {"name":"Varban Varbanov","first_time":"‚Äî","best_time":"‚Äî"}
]</script>

<script>
(async () => {
// Variant B: external JSON (expects best_time / first_time), NO adapter
let RAW;
try {
  const url = 'https://raw.githubusercontent.com/collouur/Karting-ICB-Data/main/drivers.json' + '?v=' + Date.now();
  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error('status ' + res.status);
  const json = await res.json();
  RAW = Array.isArray(json) ? json : (json && Array.isArray(json.drivers) ? json.drivers : []);
  if (!RAW || RAW.length === 0) throw new Error('empty payload');
} catch (e) {
  // fallback –∫—ä–º –≤–≥—Ä–∞–¥–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏ (—Ç–æ—á–Ω–æ –∫–∞–∫—Ç–æ v1.3)
  RAW = JSON.parse(document.getElementById('data').textContent);
}

function parseTime(str){
  if (!str || str==='‚Äî') return Number.POSITIVE_INFINITY;
  // formats: M:SS.mmm  or  SS.mmm
  if (/^\d+:\d{2}\.\d{3}$/.test(str)) {
    const [m, rest] = str.split(':');
    const [s, ms] = rest.split('.');
    return (+m)*60*1000 + (+s)*1000 + (+ms);
  }
  if (/^\d{1,2}\.\d{3}$/.test(str)) {
    const [s, ms] = str.split('.');
    return (+s)*1000 + (+ms);
  }
  return Number.POSITIVE_INFINITY;
}
function fmtDelta(ms){
  if (!isFinite(ms)) return '‚Äî';
  const sign = ms<0 ? '‚àí' : '+';
  ms = Math.abs(ms);
  const s = Math.floor(ms/1000);
  const rem = ms%1000;
  return `${sign}${s}.${String(rem).padStart(3,'0')}s`;
}

const rowsEl = document.getElementById('rows');
const countEl = document.getElementById('count');
const qEl = document.getElementById('q');

let rows = RAW.map(d => {
  const best = d.best_time || '‚Äî';
  const first = d.first_time || '‚Äî';
  const bestMs = parseTime(best);
  const firstMs = parseTime(first);
  const delta = (isFinite(bestMs) && isFinite(firstMs)) ? (bestMs - firstMs) : Number.NaN;
  return {
    name: d.name || '‚Äî',
    first, best,
    delta,
    deltaStr: isNaN(delta) ? '‚Äî' : fmtDelta(delta),
    bestMs
  };
});

function render(list){
  const q = (qEl.value || '').toLowerCase().trim();
  const filt = q ? list.filter(r => r.name.toLowerCase().includes(q)) : list;

  const html = filt.map(r => `
    <tr>
      <td class="rank">‚Äî</td>
      <td class="name">${r.name}</td>
      <td>${r.first}</td>
      <td>${r.best}</td>
      <td class="right">
        <span class="delta"><i class="dot ${r.delta<0 ? 'up' : (r.delta>0?'down':'')}"></i>${r.deltaStr}</span>
      </td>
    </tr>
  `).join('');
  rowsEl.innerHTML = html;
  countEl.textContent = `${filt.length} drivers`;
}

function clearSortActives(){
  document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
}
function sortByBest(){ rows.sort((a,b)=>a.bestMs-b.bestMs); }
function sortByFirst(){ rows.sort((a,b)=>parseTime(a.first)-parseTime(b.first)); }
function sortByAZ(){ rows.sort((a,b)=>a.name.localeCompare(b.name)); }
function sortByDelta(){
  rows.sort((a,b)=>{
    const ad = isNaN(a.delta)?Number.POSITIVE_INFINITY:a.delta;
    const bd = isNaN(b.delta)?Number.POSITIVE_INFINITY:b.delta;
    return ad-bd;
  });
}

document.querySelector('.sort-btn[data-sort="best"]').addEventListener('click', () => {
  clearSortActives(); document.querySelector('.sort-btn[data-sort="best"]').classList.add('active');
  sortByBest(); render(rows);
});
document.querySelector('.sort-btn[data-sort="first"]').addEventListener('click', () => {
  clearSortActives(); document.querySelector('.sort-btn[data-sort="first"]').classList.add('active');
  sortByFirst(); render(rows);
});
document.querySelector('.sort-btn[data-sort="az"]').addEventListener('click', () => {
  clearSortActives(); document.querySelector('.sort-btn[data-sort="az"]').classList.add('active');
  sortByAZ(); render(rows);
});
document.querySelector('.sort-btn[data-sort="delta"]').addEventListener('click', () => {
  clearSortActives(); document.querySelector('.sort-btn[data-sort="delta"]').classList.add('active');
  sortByDelta(); render(rows);
});
qEl.addEventListener('input', () => render(rows));

// Initial sort by Best
sortByBest();
document.querySelector('.sort-btn[data-sort="best"]').classList.add('active');
render(rows);
})();
</script>
</body>
</html>
